name: ðŸš€ Create COM3 Instance

on:
  workflow_dispatch:

jobs:
  create-com3:
    runs-on: ubuntu-latest
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: âš™ï¸ Setup Terraform
      uses: hashicorp/setup-terraform@v3
      
    - name: ðŸ—ï¸ Terraform Init & Apply
      run: |
        cd terraform
        terraform init
        terraform apply -auto-approve -var="ibmcloud_api_key=${{ secrets.IBM_CLOUD_API_KEY }}"
        
    - name: ðŸ“ Get COM3 IP
      id: get-ip
      run: |
        cd terraform
        IP=$(terraform output -raw com3_private_ip)
        echo "COM3_IP=$IP" >> $GITHUB_ENV
        echo "ip=$IP" >> $GITHUB_OUTPUT
        echo "ðŸŽ¯ COM3 IP: $IP"
        
    - name: ðŸ“‹ Display Instructions
      run: |
        echo "=========================================="
        echo "âœ… COM3 INSTANCE CREATED SUCCESSFULLY!"
        echo "=========================================="
        echo "COM3 IP Address: $COM3_IP"
        echo ""
        echo "ðŸ”§ MANUAL CONFIGURATION STEPS:"
        echo "1. SSH to your head node:"
        echo "   ssh clusteradmin@141.125.159.109"
        echo ""
        echo "2. From head node, configure COM3:"
        echo "   ./configure-com3.sh $COM3_IP"
        echo ""
        echo "3. Update Ansible inventory:"
        echo "   ./update-inventory.sh $COM3_IP"
        echo ""
        echo "4. Verify connection:"
        echo "   ssh clusteradmin@$COM3_IP"
        echo "=========================================="
